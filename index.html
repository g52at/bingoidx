<!DOCTYPE html>
<html lang="ja">
<head>
<link href="https://fonts.googleapis.com/earlyaccess/nikukyu.css" rel="stylesheet">
</head>
<body>
    <div class="text-outline" id="slot_zone"></div>
    <button id="start_animation">スタート</button>
    <button id="bingo_botton">ストップ</button>
    <div class="text-outline" id="logs"></div>
</body>
<script>
    const audio = new Audio('ドラムロール.mp3');
    const audio2 = new Audio('じゃーん.mp3');
    var bingo_max = 75;//ビンゴの最大値
    let refleshlate = 10; //速度
    let i = 0;
    let timerId;
    var index = 0;
    var bingo_array;
    var before_bingo = 0;
    var slot_state = false;
    var drum_flag = true;
    var bingo_botton = document.getElementById('bingo_botton').textContent;
    let text = document.getElementById('slot_zone').textContent;
    const btn0 = document.getElementById('start_animation');
    const btn1 = document.getElementById('bingo_botton');
    const spacekey = document.querySelector('body');


    function randomizing(){//ビンゴの乱数を配列で出力
        var arr = [];
        bingo_array = []; 
        for(var i=0; i < bingo_max; i++){
            arr[i]=i+1;
        }
    
        for(var j = 0, len = arr.length; j < bingo_max; j++, len--) {
            rndNum = Math.floor(Math.random()*len);
            bingo_array.push(arr[rndNum]);
            arr[rndNum] = arr[len-1];
        }
        index = 0;
    }
    document.addEventListener("keydown", keyDownHandler, false);

    function keyDownHandler(e) {
        if(e.key == " "){
            if(!slot_state){//スロット動作中
                start_slot();
            }
            else{
                stop_slot();
            }
        }   
    }

//スロットスタート時の動作
    function start_slot() {
        timerId = 0;
        audio.play();
        if (!slot_state){
            sayHello();
        };
        slot_state = true;
    }
//スロット停止時の操作
    function stop_slot(){
        if (!slot_state) return;
        audio.pause();
        audio.currentTime = 0;
        setTimeout(function(){
            audio2.play();
        },100);
        window.clearTimeout(timerId);
        bingo_main();
        slot_state = false;
    }

//ブラウザ上の開始ボタンを押した時の動作
    btn0.addEventListener('click', () => {
        start_slot();
    });
    
//ブラウザ上の停止ボタンを押した時の動作
    btn1.addEventListener('click',function(){
        stop_slot(); 
    });
    
    function sayHello(){//表示を担う
        let slot_number = Math.floor(Math.random() * 100);
        document.getElementById('slot_zone').textContent = slot_number;
        audio.play();
        timerId = setTimeout(sayHello,refleshlate);

    }

    function bingo_main(){//ビンゴのメイン処理
        if(bingo_array[index] === undefined){//今の抽選結果
            alert("抽選終了！");
//当選済みの数字の追加
        }
        else{ 
            const bingo_log_base = document.getElementById("logs");
            const bingo_log_element = document.createElement("result");
            const textnode = document.createTextNode(bingo_array[index]);
            bingo_log_element.appendChild(textnode);
            bingo_log_base.appendChild(bingo_log_element);
        }
        document.getElementById('slot_zone').textContent = bingo_array[index];
        before_bingo = bingo_array[index];
        bingo_array.shift();
        if (bingo_array.length < index){
        }
    }
/*
    const keyzone = document.querySelector('body');
    document.addEventListener('keydown',(e) => {
        if(slot_state == true){//ビンゴ停止と同じ
            if (!slot_state) return;
            window.clearTimeout(timerId);
            bingo_main();
            slot_state = false;
        }else if(slot_state == false){//ビンゴ開始と同じ
                timerId = 0;
            if (!slot_state){
                sayHello();
            };
            slot_state = true;
        }
    });
*/
    
//関数の外
    document.getElementById("slot_zone").innerHTML = 'OK!';
    window.onload = randomizing();// 自動実行
    </script>
    <style>
        *{
            font-family: "Nikukyu";
            background-color: #18233F;
            text-align: center;
        }
        .text-outline{
          text-shadow: 
            -1px -1px 0 #FFFFFF,
            1px -1px 0 #FFFFFF,
            -1px 1px 0 #FFFFFF,
            1px 1px 0 #FFFFFF;
        }
        #slot_zone{
          font-size: 200px;
          color: black;
          border-radius: 40px;        
          background-color: #FFC93C;
          font-weight: bold;
          text-shadow: 
            -3px -3px 0 #FFFFFF,
            3px -3px 0 #FFFFFF,
            -3px 3px 0 #FFFFFF,
            3px 3px 0 #FFFFFF;
        }
        button{
            padding: 20px;
            border-radius: 10px;
        }
        #start_animation{
            background-color: cornflowerblue;
        }
        #bingo_botton{
            background-color: deeppink;
        }

        result{
            font-size: 80px;
            display: inline-block;
            margin-left: 10px;
            padding: 12px;
            color: black;
            background-color: #FFC93C;
            border-radius: 40px;
            font-weight: bold;
        }

    </style>
</html>